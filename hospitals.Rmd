---
title: "Hospitals"
author: "Andre Williams"
date: '2022-06-13'
output: html_document
---


Reading the Data set in.

```{r}
library(tidyverse)
hospitals <- read.csv("http://www.stat.cmu.edu/cmsac/sure/2022/materials/data/health/eda_projects/hospitals.csv")
head(hospitals)
```


Hypotheses #1: Government will have the worse overall rating.

1) Grouping the data set by the facility type.
2) Averaging the ratings of each facility type.
3) Displaying the new table with the facility type and average overall rating.

```{r}
hospital_ratings <- hospitals %>%
  group_by(Facility.Type) %>%
  summarize(Overall.Ratings = mean(Rating.Overall))

hospital_ratings

```

4) Plotting the average hospital ratings by facility.

```{r}
hospital_ratings %>%
  ggplot(aes(x = Facility.Type, y = Overall.Ratings, fill = Facility.Type)) +
  geom_col(width = 0.5) +
  theme_bw()


```

Our first hypotheses was deemed correct, as government hospitals had an overall rating of ~1.5 stars.








Hypotheses #2: States with a high timeliness rating would have a higher effectiveness rating than most places.

1)Install the 'usmap' package

```{r}
install.packages("usmap")
```

```{r}
hospital_cost <- hospitals %>%
  group_by(Facility.State)
```


```{r}
hospital_cost <- hospital_cost %>%
  summarise(Avg_Cost = mean(Procedure.Heart.Attack.Cost))

colnames(hospital_cost)[1] <- 'state'
```

```{r}
hospital_cost
```

```{r}
library(usmap)
library(ggplot2)



plot_usmap(data = hospital_cost, values = "Avg_Cost", color = "red") + 
  scale_fill_continuous(low = "yellow", high = "darkred", name = "Avg Cost", label = scales::comma) + 
  theme(legend.position = "right")


```



















```{r}
hospital_cost <- hospitals %>%
  select(Facility.State, Procedure.Heart.Attack.Cost) %>%
  group_by(Facility.State) %>%
  summarize(avg_cost = mean(Procedure.Heart.Attack.Cost)) %>%
  arrange(desc(avg_cost))
  
  
hospital_cost

```


```{r}
library(plyr)
hospitals$Procedure.Heart.Attack.Quality <- revalue(hospitals$Procedure.Heart.Attack.Quality, c("Better" = 1, "Unknown" = -1, "Lower" = 2, "Worse" = 4, "Average" = 3))
hospitals <- hospitals %>%
  mutate_at(vars(Procedure.Heart.Attack.Quality), as.numeric)

```



```{r}
hospitals %>%
  select(Facility.State, Procedure.Heart.Attack.Quality)
```

```{r}
hospitals %>%
  mutate(hospital_cpq = Procedure.Heart.Attack.Cost / Procedure.Heart.Attack.Quality)

```

```{r}
hospital_costperquality <- hospitals %>%
  select(Facility.Stat  group_by(Facility.State) %>%
  summarize(cpq = mean(hospital_cpq))

hospital_costperquality

```