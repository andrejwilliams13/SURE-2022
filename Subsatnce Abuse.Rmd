---
title: "Substance Abuse"
author: "Andre Williams"
date: '2022-07-20'
output:
  html_document: default
---

# Where do most drug overdose deaths occur and what are some characteristics of those areas(income, education, unemployment)?


__Datasets Used__

County Health Rankings

12 Month-ending Provisional Number and Percent Change of Drug Overdose Deaths

Median Household Income


```{r include=FALSE, echo=FALSE}
library(tidyverse)

d3 <- read.csv("~/SURE-2022/Drug-Alcohol Overdose Deaths.csv")
county_rankings <- read.csv("~/SURE-2022/county_rankings.csv")
income <- read.csv("~/SURE-2022/MedianHouseholdIncome.csv")
```

```{r include=FALSE, echo=FALSE}
# Cleaning the data

d3$Data.Value <- as.integer(gsub(",", "", d3$Data.Value))

d3 <- d3 %>%
  arrange(State) %>%
  filter(Year %in% "2019",
         Indicator %in% "Number of Drug Overdose Deaths",
         !State %in% c("DC", "YC")) %>%
  select(State, Indicator, Data.Value) %>%
  group_by(State) %>%
  summarise(total_deaths = sum(Data.Value)) %>%
  mutate(Total.deaths.raw.value = (total_deaths / 822382) * 100) %>%
  filter(!State %in% "US")

colnames(d3)[1] <- 'state'
```

```{r include=FALSE, echo=FALSE}
county_rankings <- county_rankings %>%
  arrange(State.Abbreviation) %>%
  filter(County.FIPS.Code %in% 0,
         !State.Abbreviation %in% c("US", "DC")) %>%
  select(State.Abbreviation, Unemployment.raw.value, Some.college.raw.value, High.school.completion.raw.value) %>%
  mutate(Unemployment.raw.value = (Unemployment.raw.value * 100),
         High.school.completion.raw.value = (High.school.completion.raw.value * 100),
         Some.college.raw.value = (Some.college.raw.value * 100))

colnames(county_rankings)[1] <- 'state'
```

```{r echo=FALSE}
colnames(income)[1] <- 'state'
income <- income %>%
  mutate(state = fct_recode(state,
                            "MD" = "Maryland",
                            "NJ" = "New Jersey",
                            "HI" = "Hawaii",
                            "MA" = "Massachusetts",
                            "CT" = "Connecticut",
                            "AK" = "Alaska",
                            "NH" = "New Hampshire",
                            "CA" = "California",
                            "VA" = "Virginia",
                            "WA" = "Washington",
                            "CO" = "Colorado",
                            "UT" = "Utah",
                            "MN" = "Minnesota",
                            "NY" = "New York",
                            "DE" = "Delaware",
                            "RI" = "Rhode Island",
                            "IL" = "Illinois",
                            "ND" = "North Dakota",
                            "WY" = "Wyoming",
                            "OR" = "Oregon",
                            "VT" = "Vermont",
                            "TX" = "Texas",
                            "WI" = "Wisconsin",
                            "PA" = "Pennsylvania",
                            "NE" = "Nebraska",
                            "IA" = "Iowa",
                            "NV" = "Nevada",
                            "KS" = "Kansas",
                            "AZ" = "Arizona",
                            "GA" = "Georgia",
                            "SD" = "South Dakota",
                            "ME" = "Maine",
                            "MI" = "Michigan",
                            "OH" = "Ohio",
                            "IN" = "Indiana",
                            "ID" = "Idaho",
                            "FL" = "Florida",
                            "MO" = "Missouri",
                            "MT" = "Montana",
                            "NC" = "North Carolina",
                            "TN" = "Tennessee",
                            "SC" = "South Carolina",
                            "OK" = "Oklahoma",
                            "KY" = "Kentucky",
                            "AL" = "Alabama",
                            "NM" = "New Mexico",
                            "LA" = "Louisiana",
                            "AR" = "Arkansas",
                            "WV" = "West Virginia",
                            "MS" = "Mississippi"))
```

```{r echo=FALSE, include=FALSE}
# Combining the data

library(dplyr)

first <- dplyr::left_join(x = d3, y = county_rankings, by = 'state')
combined <- dplyr::left_join(x = first, y = income, by = 'state')
```

__Plotting the total drug overdose deaths per state in 2019__

```{r echo=FALSE}
library(usmap)
library(ggplot2)

plot_usmap(data = combined, values = "total_deaths", color = "red") + 
  scale_fill_continuous(low = "yellow", high = "darkred", name = "Total Deaths", label = scales::comma) + 
  theme(legend.position = "right")

```




__Looking at the most used drug in California__

```{r echo=FALSE}
d3 <- read.csv("~/SURE-2022/Drug-Alcohol Overdose Deaths.csv")
d3$Data.Value <- as.integer(gsub(",", "", d3$Data.Value))

d3 <- d3 %>%
  arrange(desc(Data.Value)) %>%
  filter(Year %in% "2019",
         !Indicator %in% c("Percent with drugs specified", "Number of Deaths",
                        "Number of Drug Overdose Deaths"),
         State %in% "CA") %>%
  select(State, Indicator, Data.Value)

head(d3, 3)
```

__Looking at the most used drug in Florida__

```{r echo=FALSE}
d3 <- read.csv("~/SURE-2022/Drug-Alcohol Overdose Deaths.csv")
d3$Data.Value <- as.integer(gsub(",", "", d3$Data.Value))

d3 <- d3 %>%
  arrange(desc(Data.Value)) %>%
  filter(Year %in% "2019",
         !Indicator %in% c("Percent with drugs specified", "Number of Deaths",
                        "Number of Drug Overdose Deaths"),
         State %in% "FL") %>%
  select(State, Indicator, Data.Value)

head(d3, 3)
```

__Looking at the most used drug in Texas__

```{r echo=FALSE}
d3 <- read.csv("~/SURE-2022/Drug-Alcohol Overdose Deaths.csv")
d3$Data.Value <- as.integer(gsub(",", "", d3$Data.Value))

d3 <- d3 %>%
  arrange(desc(Data.Value)) %>%
  filter(Year %in% "2019",
         !Indicator %in% c("Percent with drugs specified", "Number of Deaths",
                        "Number of Drug Overdose Deaths"),
         State %in% "TX") %>%
  select(State, Indicator, Data.Value)

head(d3, 3)
```

__Looking at the most used drug in Ohio__

```{r echo=FALSE}
d3 <- read.csv("~/SURE-2022/Drug-Alcohol Overdose Deaths.csv")
d3$Data.Value <- as.integer(gsub(",", "", d3$Data.Value))

d3 <- d3 %>%
  arrange(desc(Data.Value)) %>%
  filter(Year %in% "2019",
         !Indicator %in% c("Percent with drugs specified", "Number of Deaths",
                           "Number of Drug Overdose Deaths"),
         State %in% "OH") %>%
  select(State, Indicator, Data.Value)

head(d3, 3)
```

__Median Household Income By State__

```{r echo=FALSE}
library(usmap)
library(ggplot2)

plot_usmap(data = income, values = "HouseholdIncome", color = "red") + 
  scale_fill_continuous(low = "yellow", high = "darkred", name = "Median Income", label = scales::comma) + 
  theme(legend.position = "right")

```


__Highschool Completion__

```{r echo=FALSE}
library(usmap)
library(ggplot2)

plot_usmap(data = combined, values = "High.school.completion.raw.value",
           color = "red") + 
  scale_fill_continuous(low = "yellow", high = "darkred", name = "HS Completion %", label = scales::comma) + 
  theme(legend.position = "right")
```

__Unemployment Rate by State__

```{r echo=FALSE}
library(usmap)
library(ggplot2)

plot_usmap(data = combined, values = "Unemployment.raw.value",
           color = "red") + 
  scale_fill_continuous(low = "yellow", high = "darkred", name = "Unemployment %", label = scales::comma) + 
  theme(legend.position = "right")
```

__College Experience__

```{r echo=FALSE}
library(usmap)
library(ggplot2)

plot_usmap(data = combined, values = "Some.college.raw.value",
           color = "red") + 
  scale_fill_continuous(low = "yellow", high = "darkred", name = "College Experience %", label = scales::comma) + 
  theme(legend.position = "right")
```

_Clustering of Total deaths by the socioeconomic factors__

```{r echo=FALSE}
init_kmeans <- 
  kmeans(dplyr::select(combined,
                       total_deaths, Unemployment.raw.value),
         algorithm = "Lloyd", centers = 3,
         nstart = 1)

combined %>%
  mutate(state_clusters = 
           as.factor(init_kmeans$cluster)) %>%
  ggplot(aes(x = total_deaths, y = Unemployment.raw.value,
             color = state_clusters)) +
  geom_point() + 
  ggthemes::scale_color_colorblind() +
  theme_bw() +
  theme(legend.position = "bottom")
```

```{r echo=FALSE}
init_kmeans <- 
  kmeans(dplyr::select(combined,
                       total_deaths, Some.college.raw.value),
         algorithm = "Lloyd", centers = 3,
         nstart = 1)

combined %>%
  mutate(state_clusters = 
           as.factor(init_kmeans$cluster)) %>%
  ggplot(aes(x = total_deaths, y = Some.college.raw.value,
             color = state_clusters)) +
  geom_point() + 
  ggthemes::scale_color_colorblind() +
  theme_bw() +
  theme(legend.position = "bottom")
```

```{r echo=FALSE}
init_kmeans <- 
  kmeans(dplyr::select(combined,
                       total_deaths, High.school.completion.raw.value),
         algorithm = "Lloyd", centers = 3,
         nstart = 1)

combined %>%
  mutate(state_clusters = 
           as.factor(init_kmeans$cluster)) %>%
  ggplot(aes(x = total_deaths, y = High.school.completion.raw.value,
             color = state_clusters)) +
  geom_point() + 
  ggthemes::scale_color_colorblind() +
  theme_bw() +
  theme(legend.position = "bottom")
```

__Clustering with the standardized variables__

```{r echo=FALSE}
combined <- combined %>%
  mutate(std_death = as.numeric(scale(total_deaths, center = TRUE, scale = TRUE)),
         std_unemploy = as.numeric(scale(Unemployment.raw.value, center = TRUE, scale = TRUE)),
         std_hs = as.numeric(scale(High.school.completion.raw.value, center = TRUE, scale = TRUE)),
         std_college = as.numeric(scale(Some.college.raw.value, center = TRUE, scale = TRUE)))
```

```{r echo=FALSE}
std_kmeans <- 
  kmeans(dplyr::select(combined, std_death, std_unemploy),
         algorithm = "Lloyd", centers = 4, nstart = 1)

combined %>%
  mutate(state_clusters = 
           as.factor(std_kmeans$cluster)) %>%
  ggplot(aes(x = std_death, y = std_unemploy,
             color = state_clusters)) +
  geom_point() + 
  ggthemes::scale_color_colorblind() +
  theme_bw() +
  theme(legend.position = "bottom") +
  coord_fixed()

```

```{r echo=FALSE}
std_kmeans <- 
  kmeans(dplyr::select(combined, std_death, std_hs),
         algorithm = "Lloyd", centers = 4, nstart = 1)

combined %>%
  mutate(state_clusters = 
           as.factor(std_kmeans$cluster)) %>%
  ggplot(aes(x = std_death, y = std_hs,
             color = state_clusters)) +
  geom_point() + 
  ggthemes::scale_color_colorblind() +
  theme_bw() +
  theme(legend.position = "bottom") +
  coord_fixed()

```

```{r echo=FALSE}
std_kmeans <- 
  kmeans(dplyr::select(combined, std_death, std_college),
         algorithm = "Lloyd", centers = 4, nstart = 1)

combined %>%
  mutate(state_clusters = 
           as.factor(std_kmeans$cluster)) %>%
  ggplot(aes(x = std_death, y = std_college,
             color = state_clusters)) +
  geom_point() + 
  ggthemes::scale_color_colorblind() +
  theme_bw() +
  theme(legend.position = "bottom") +
  coord_fixed()

```

__Model Based Clustering__

```{r echo=FALSE, include=FALSE}
library(mclust)

death_college_clust <- Mclust(dplyr::select(combined, total_deaths, Some.college.raw.value))

death_unemploy_clust <- Mclust(dplyr::select(combined, total_deaths, Unemployment.raw.value))

death_hs_clust <- Mclust(dplyr::select(combined, total_deaths, High.school.completion.raw.value))
```

```{r echo=FALSE}
plot(death_college_clust, what = 'classification')
```

```{r echo=FALSE}
plot(death_hs_clust, what = 'classification')
```

```{r echo=FALSE}
plot(death_unemploy_clust, what = 'classification')
```



